# Автотестирование webcalculator.exe

## Описание

В рамках технического задания реализованы следующие тесты:

1. **API Тестирование**:
   - Проверка корректности формата запросов и ответов для всех доступных API-методов. Это включает в себя проверку структуры и содержимого ответов от сервера, чтобы убедиться, что API соответствует ожидаемым данным.

2. **Тестирование Основной Функциональности**:
   - Проверка правильности вычислений и обработки допустимых входных данных. 

3. **Функциональные Тесты Управления Приложением**:
   - **Запуск Приложения**:
     - Тестирование запуска приложения с указанием дополнительных аргументов `host` и `port`. Проверяется корректность использования значений по умолчанию, если аргументы не указаны. 


   - **Остановка Приложения**:
     - Проверка корректности выполнения команды `stop`, которая должна завершать работу приложения. Убедиться, что приложение корректно останавливается и не работает после выполнения команды.

   - **Перезапуск Приложения**:
     - Тестирование команды `restart`, которая должна перезапускать приложение, сохраняя те же параметры адреса и порта. Проверяется, что приложение продолжает работать на тех же адресе и порте после перезапуска.

   - **Вывод Логов**:
     - Проверка корректности выполнения команды `show_log`, которая должна выводить содержимое лог-файла приложения. Убедиться, что содержимое лог-файла отображается корректно и полностью.

   - **Справка по Использованию**:
     - Тестирование вывода справки по использованию приложения при указании аргументов `-h` или `--help`. Проверяется, что вывод содержит краткую справку по всем доступным командам и параметрам приложения.

## Структура Проекта
- `src`
    - `app/` - директория с самим приложением
    - `tests/` — директория с тестами.
        - `api/` — тесты для API.
        - `management/` — тесты для проверки функционала управления приложением.
        - `variables.py` - общие переменные
- `.env.example` - файл-пример с переменными окружения
- `pytest.ini` — конфигурация pytest.
- `requirements.txt` — зависимости проекта.

## Установка зависимостей

Для работы проекта необходима установка зависимостей из файла requirements.txt. Рекомендую для этого создать виртуальное окружение.

### Создание Виртуального Окружения и Установка Зависимостей

1. **Создайте виртуальное окружение**:

     ```bash
     python -m venv venv
     ```

2. **Активируйте виртуальное окружение**:
   - На **Windows**:
     ```bash
     venv\Scripts\activate
     ```
   - На **Unix или MacOS**:
     ```bash
     source venv/bin/activate
     ```

3. **Установите зависимости из файла `requirements.txt`**:

     ```bash
     pip install -r requirements.txt
     ```

## Конфигурация

Для настройки переменных окружения создайте файл `.env` в корневой директории проекта. Вы можете использовать файл `.env.example` в качестве шаблона.

1. **Создайте файл `.env`**:
   - Скопируйте файл `.env.example` и назовите его `.env`:
     ```bash
     cp .env.example .env
     ```

2. **Настройте переменные окружения**:
   - Откройте файл `.env` и укажите значения для переменных `WEB_CALCULATOR_HOST` и `WEB_CALCULATOR_PORT`. Эти переменные задают хост и порт, на которых будет запущено приложение во время тестирования.
     ```env
     WEB_CALCULATOR_HOST=localhost
     WEB_CALCULATOR_PORT=5413
     ```

   - Если переменные не указаны, приложение будет использовать значения по умолчанию: хост `127.0.0.1` и порт `17678`.
  
## Запуск и логика работы

Скрипт `run_tests.py` запускает процесс тестирования в два этапа:

  ```bash
      python run_tests.py
  ```
    

1. **Запуск приложения и тестирование API**:
   - При запуске скрипта `run_tests.py` приложение стартует с использованием фикстуры, которая его инициализирует.
   - После запуска приложения выполняются тесты, проверяющие корректность работы API методов. Эти тесты включают проверку формата запросов и ответов, а также правильность вычислений основных методов приложения.

2. **Тестирование системы управления приложением**:
   - После завершения тестов API, скрипт переходит к тестам системы управления приложением.
   - Сначала тесты выполняются при запуске приложения без указания аргументов (`host` и `port`), используя значения по умолчанию.
   - Затем тесты повторяются при запуске приложения с указанием конкретных аргументов `host` и `port`, заданных в конфигурационном файле `.env`.

## Найденные дефекты

В примечании к тестовому заданию указано, что приложение может содержать как умышленные, так и случайно допущенные дефекты.

Обнаруженные дефекты:


1. **Неверный код ошибки при ошибках вычисления**:
   - **Описание**: В ответ на запрос, предполагающего ошибку в вычислении, например деление на ноль, приходит ответ с кодом статуса 8, вместо 1, как указано в документации.
   - **Пример тела запроса**:
     ```json
     {
         "x": 10,
         "y": 0
     }
     ```
   - **Тип запроса**: POST /division
   - **Пример ответа**:
     ```json
     {
         "statusCode": 8,
         "statusMessage": "Ошибка вычисления"
     }
     ```
   - **Ожидаемый ответ**:
     ```json
     {
         "statusCode": 1,
         "statusMessage": "Ошибка вычисления"
     }
     ```

2. **Превышение границ int32 не приводит к ошибке**:
   - **Описание**: Входные значения x и y в любых запросах должны быть в границах int32 [-2147483648:2147483647], но при x = INT32_MAX + 1 запрос на любой из методов все равно проходит без ошибки. Остальные подобные кейсы соответствуют документации.
   - **Пример тела запроса**:
     ```json
     {
         "x": 2147483648,  // INT32_MAX + 1
         "y": 1
     }
     ```
   - **Тип запроса**: POST /addition
   - **Пример ответа**:
     ```json
     {
         "statusCode": 0,
         "result": 2147483649
     }
     ```
   - **Ожидаемый ответ**:
     ```json
     {
         "statusCode": 4,
         "statusMessage": "Превышен размер одного из значений"
     }
     ```
  


